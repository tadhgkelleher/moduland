<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Modular - Premium modular housing solutions for landowners and buyers in Ireland.">
    <title>Modular - Luxury Modular Homes</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin=""/>
    
    <!-- Google Fonts for Premium Typography -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap">
    
    <style>
        /* Minimal CSS Reset */
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: linear-gradient(135deg, #1A3C34 0%, #0F241F 100%); /* Deep forest green */
            --accent: linear-gradient(135deg, #5A8EB8 0%, #3A6791 100%); /* Rich sapphire blue */
            --highlight: linear-gradient(135deg, #EAD9A3 0%, #D9C282 100%); /* Warm gold */
            --light-bg: linear-gradient(180deg, #F7F8F7 0%, #E9ECE9 100%); /* Soft neutral */
            --white: #FFFFFF; 
            --text: #1A2F27; 
            --text-light: #5A5A5A;
            --shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            --shadow-hover: 0 12px 36px rgba(0, 0, 0, 0.18);
            --border-light: #D4D9D6;
            --transition: all 0.3s ease-in-out;
            --border-radius-md: 10px;
            --border-radius-lg: 14px;
            --gradient-overlay: linear-gradient(180deg, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.85) 100%);
            --cta-hover: linear-gradient(135deg, #3A6791 0%, #D9C282 100%);
            --modal-bg: linear-gradient(135deg, #FFFFFF 0%, #F4F6F4 100%);
        }
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            line-height: 1.8; 
            background: var(--light-bg); 
            color: var(--text); 
            overflow-x: hidden; 
        }
        .container { max-width: 1320px; margin: 0 auto; padding: 0 24px; }
        :focus-visible { outline: 3px solid #3A6791; outline-offset: 3px; }
        header { 
            background: var(--primary); 
            color: var(--white); 
            padding: 2.5rem 0; 
            position: sticky; 
            top: 0; 
            z-index: 1000; 
            box-shadow: var(--shadow); 
        }
        header h1 { 
            font-size: 3rem; 
            font-weight: 700; 
            text-align: center; 
            text-transform: uppercase; 
            letter-spacing: 2px; 
            background: var(--highlight); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
        }
        header p { 
            font-size: 1.15rem; 
            opacity: 0.9; 
            text-align: center; 
            margin-top: 0.5rem; 
            font-weight: 300; 
        }
        main { padding-top: 1.5rem; }
        .hero { 
            background: linear-gradient(135deg, #FFFFFF 0%, #F4F6F4 100%); 
            padding: 4rem 2.5rem; 
            text-align: center; 
            margin: 2.5rem 0; 
            border-radius: var(--border-radius-lg); 
            box-shadow: var(--shadow); 
            animation: fadeIn 1s ease-out; 
            position: relative; 
            overflow: hidden; 
        }
        .hero::before { 
            content: ''; 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: radial-gradient(circle at top left, rgba(90,142,184,0.15), transparent 70%); 
            z-index: 0; 
        }
        .hero h2, .hero p { position: relative; z-index: 1; }
        .hero h2 { 
            font-size: 2.8rem; 
            background: var(--primary); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            margin-bottom: 1.5rem; 
            font-weight: 600; 
        }
        .hero p { 
            font-size: 1.2rem; 
            max-width: 800px; 
            margin: 0 auto; 
            color: var(--text-light); 
            font-weight: 300; 
        }
        .gallery { 
            padding: 4rem 0; 
            text-align: center; 
            background: var(--light-bg); 
        }
        .gallery h2 { 
            font-size: 2.4rem; 
            background: var(--primary); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            margin-bottom: 2.5rem; 
            font-weight: 600; 
        }
        .gallery-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); 
            gap: 2.5rem; 
        }
        .gallery-item { 
            position: relative; 
            overflow: hidden; 
            border-radius: var(--border-radius-lg); 
            box-shadow: var(--shadow); 
            transition: transform var(--transition), box-shadow var(--transition); 
            background: var(--light-bg); 
        }
        .gallery-item:hover, .gallery-item:focus-within { 
            transform: translateY(-8px); 
            box-shadow: var(--shadow-hover); 
        }
        .gallery-item img { 
            width: 100%; 
            height: 280px; 
            object-fit: cover; 
            display: block; 
            transition: transform var(--transition); 
        }
        .gallery-item:hover img { transform: scale(1.08); }
        .gallery-caption { 
            position: absolute; 
            bottom: 0; 
            left: 0; 
            right: 0; 
            background: var(--gradient-overlay); 
            color: var(--white); 
            padding: 1rem 1.25rem; 
            font-size: 0.95rem; 
            transform: translateY(100%); 
            transition: transform var(--transition); 
            font-weight: 400; 
        }
        .gallery-item:hover .gallery-caption, .gallery-item:focus-within .gallery-caption { 
            transform: translateY(0); 
        }
        .cta-sections { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); 
            gap: 2.5rem; 
            margin: 3rem 0; 
        }
        .cta-section { 
            background: linear-gradient(135deg, #FFFFFF 0%, #F4F6F4 100%); 
            padding: 2.5rem; 
            border-radius: var(--border-radius-lg); 
            box-shadow: var(--shadow); 
            text-align: center; 
            transition: transform var(--transition), box-shadow var(--transition); 
            position: relative; 
            overflow: hidden; 
        }
        .cta-section::before { 
            content: ''; 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: radial-gradient(circle at bottom right, rgba(234,217,163,0.15), transparent 70%); 
            z-index: 0; 
            transition: opacity var(--transition); 
            opacity: 0; 
        }
        .cta-section:hover::before { opacity: 1; }
        .cta-section:hover { 
            transform: translateY(-12px); 
            box-shadow: var(--shadow-hover); 
        }
        .cta-section h2, .cta-section p, .cta-button { position: relative; z-index: 1; }
        .cta-section h2 { 
            font-size: 2.1rem; 
            background: var(--primary); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            margin-bottom: 1.25rem; 
            font-weight: 600; 
        }
        .cta-section p { 
            font-size: 1.1rem; 
            color: var(--text-light); 
            margin-bottom: 1.75rem; 
            font-weight: 300; 
        }
        .cta-button { 
            display: inline-block; 
            background: var(--accent); 
            color: var(--white); 
            padding: 0.9rem 2rem; 
            text-decoration: none; 
            border-radius: 50px; 
            font-weight: 600; 
            transition: background var(--transition), transform var(--transition), box-shadow var(--transition); 
            border: 2px solid transparent; 
        }
        .cta-button:hover, .cta-button:focus-visible { 
            background: var(--cta-hover); 
            transform: scale(1.06); 
            box-shadow: 0 4px 12px rgba(58,103,145,0.3); 
            border-color: #0F241F; 
        }
        .how-it-works { 
            background: linear-gradient(135deg, #FFFFFF 0%, #F4F6F4 100%); 
            padding: 4rem 2.5rem; 
            margin: 3rem 0; 
            border-radius: var(--border-radius-lg); 
            text-align: center; 
            box-shadow: var(--shadow); 
        }
        .how-it-works h2 { 
            font-size: 2.4rem; 
            background: var(--primary); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            margin-bottom: 2rem; 
            font-weight: 600; 
        }
        .how-it-works ol { 
            list-style-position: inside; 
            padding-left: 0; 
            max-width: 650px; 
            margin: 0 auto; 
        }
        .how-it-works li { 
            font-size: 1.15rem; 
            color: var(--text-light); 
            margin: 1rem 0; 
            text-align: left; 
            transition: color var(--transition); 
            font-weight: 400; 
        }
        .how-it-works li:hover { color: #1A3C34; }
        .how-it-works li::marker { color: #1A3C34; font-weight: bold; }
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: linear-gradient(135deg, rgba(0,0,0,0.65) 0%, rgba(15,36,31,0.85) 100%); 
            align-items: center; 
            justify-content: center; 
            z-index: 2000; 
            opacity: 0; 
            transition: opacity 0.4s ease-in-out; 
            padding: 24px; 
        }
        .modal.is-open { display: flex; opacity: 1; }
        .modal-content-wrapper { 
            background: var(--modal-bg); 
            padding: 3rem; 
            border-radius: var(--border-radius-lg); 
            max-width: 600px; 
            width: 100%; 
            text-align: center; 
            position: relative; 
            box-shadow: var(--shadow-hover); 
            transform: scale(0.9); 
            transition: transform 0.4s ease-in-out; 
        }
        .modal.is-open .modal-content-wrapper { transform: scale(1); }
        .modal-content-wrapper h2 { 
            font-size: 2.2rem; 
            background: var(--primary); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            margin-bottom: 1.5rem; 
            font-weight: 600; 
        }
        .modal-content-wrapper form { 
            display: flex; 
            flex-direction: column; 
            gap: 1.25rem; 
        }
        .modal-content-wrapper label { 
            text-align: left; 
            font-size: 0.95rem; 
            color: #1A3C34; 
            font-weight: 600(tok; margin-bottom: -0.4rem; 
        }
        .modal-content-wrapper input, 
        .modal-content-wrapper select, 
        .modal-content-wrapper textarea { 
            padding: 0.9rem; 
            border: 1px solid var(--border-light); 
            border-radius: var(--border-radius-md); 
            font-size: 1rem; 
            width: 100%; 
            background: linear-gradient(180deg, #FFFFFF 0%, #F4F6F4 100%); 
            transition: border-color var(--transition), box-shadow var(--transition); 
            font-family: 'Inter', sans-serif; 
        }
        .modal-content-wrapper input:focus-visible, 
        .modal-content-wrapper select:focus-visible, 
        .modal-content-wrapper textarea:focus-visible { 
            border-color: #3A6791; 
            box-shadow: 0 0 8px rgba(58,103,145,0.2); 
            outline: none; 
        }
        .modal-content-wrapper textarea { 
            resize: vertical; 
            min-height: 120px; 
        }
        .modal-content-wrapper button[type="submit"] { 
            background: var(--accent); 
            color: var(--white); 
            padding: 1rem; 
            border: none; 
            border-radius: 50px; 
            font-weight: 600; 
            cursor: pointer; 
            transition: background var(--transition), transform var(--transition), box-shadow var(--transition); 
        }
        .modal-content-wrapper button[type="submit"]:hover, 
        .modal-content-wrapper button[type="submit"]:focus-visible { 
            background: var(--cta-hover); 
            transform: translateY(-3px); 
            box-shadow: 0 6px 16px rgba(58,103,145,0.3); 
        }
        .modal-content-wrapper button[type="submit"]:disabled { 
            background: #B0B0B0; 
            cursor: not-allowed; 
            transform: none; 
            box-shadow: none; 
        }
        .close-modal { 
            position: absolute; 
            top: 15px; 
            right: 18px; 
            font-size: 2.2rem; 
            font-weight: bold; 
            line-height: 1; 
            cursor: pointer; 
            color: var(--text-light); 
            background: none; 
            border: none; 
            padding: 0.3rem; 
            transition: color var(--transition); 
        }
        .close-modal:hover, .close-modal:focus-visible { color: #1A3C34; }
        footer { 
            background: var(--primary); 
            color: var(--white); 
            padding: 2.5rem 1.25rem; 
            text-align: center; 
            margin-top: 4rem; 
            position: relative; 
        }
        footer::before { 
            content: ''; 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: radial-gradient(circle at center, rgba(90,142,184,0.25), transparent 70%); 
            z-index: 0; 
        }
        footer p, .social-icons { position: relative; z-index: 1; }
        footer p { 
            margin: 0 0 1rem 0; 
            font-size: 0.95rem; 
            font-weight: 300; 
        }
        .social-icons { margin-top: 1.25rem; }
        .social-icons a { 
            color: var(--white); 
            font-size: 1.6rem; 
            margin: 0 0.8rem; 
            text-decoration: none; 
            transition: var(--transition); 
            display: inline-block; 
        }
        .social-icons a:hover, .social-icons a:focus-visible { 
            background: var(--highlight); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            transform: scale(1.15); 
        }
        
        /* Map-specific styles */
        #map-container { 
            padding: 3.5rem 0; 
            background: var(--light-bg); 
            border-radius: var(--border-radius-lg); 
            position: relative; 
        }
        #map-container h2 { 
            font-size: 2.4rem; 
            background: var(--primary); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            margin-bottom: 2rem; 
            font-weight: 600; 
        }
        #map { 
            height: 600px; 
            width: 100%; 
            border-radius: 12px; 
            box-shadow: var(--shadow); 
            margin: 0 auto; 
            max-width: 1080px; 
            filter: brightness(1.05) contrast(1.1); /* Enhance OSM tiles */
            transition: box-shadow var(--transition); 
        }
        #map:hover { box-shadow: var(--shadow-hover); }
        .form-map-container { 
            height: 260px; 
            width: 100%; 
            margin-bottom: 0.6rem; 
            border-radius: 10px; 
            background: #F7F8F7; 
            border: 1px solid var(--border-light); 
            transition: border-color var(--transition); 
        }
        .form-map-container:hover { border-color: #3A6791; }
        .form-map-instruction { 
            display: block; 
            margin-top: -0.7rem; 
            margin-bottom: 1.25rem; 
            font-size: 0.85rem; 
            color: var(--text-light); 
            font-weight: 300; 
        }
        
        /* Leaflet control styling */
        .leaflet-container { font-family: 'Inter', sans-serif; }
        .leaflet-control-container .leaflet-control-zoom { 
            border: none; 
            background: linear-gradient(135deg, #FFFFFF 0%, #F4F6F4 100%); 
            border-radius: 8px; 
            box-shadow: var(--shadow); 
            transition: box-shadow var(--transition); 
        }
        .leaflet-control-zoom a { 
            color: #1A3C34; 
            font-weight: 600; 
            transition: background var(--transition); 
        }
        .leaflet-control-zoom a:hover { background: var(--highlight); }
        .leaflet-popup-content-wrapper { 
            background: linear-gradient(135deg, #FFFFFF 0%, #F4F6F4 100%); 
            border-radius: 10px; 
            padding: 0.8rem; 
            box-shadow: 0 4px 16px rgba(0,0,0,0.2); 
        }
        .leaflet-popup-content { 
            margin: 0.6rem 0.8rem; 
            font-size: 0.9rem; 
            line-height: 1.6; 
            color: #1A2F27; 
            font-weight: 400; 
        }
        .leaflet-popup-content strong { 
            font-size: 1rem; 
            font-weight: 700; 
            color: #1A3C34; 
        }
        .leaflet-popup-tip { background: #FFFFFF; }
        .leaflet-container a.leaflet-popup-close-button { 
            top: 6px; 
            right: 10px; 
            color: var(--text-light); 
            font-size: 1.4rem; 
            padding: 4px; 
            transition: color var(--transition); 
        }
        .leaflet-container a.leaflet-popup-close-button:hover { color: #1A3C34; }
        
        /* Custom marker animations */
        .leaflet-marker-icon { transition: transform 0.3s ease; }
        .leaflet-marker-icon:hover { transform: scale(1.2); }

        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(24px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        @media (max-width: 768px) { 
            header h1 { font-size: 2.4rem; } 
            header p { font-size: 1.05rem; } 
            .hero h2 { font-size: 2.2rem; } 
            .cta-section h2, .gallery h2, .how-it-works h2, #map-container h2 { font-size: 2rem; } 
            .cta-sections, .gallery-grid { grid-template-columns: 1fr; } 
            .gallery-item img { height: 240px; } 
            .modal-content-wrapper { padding: 2.5rem 2rem; } 
            #map { height: 500px; } 
        }
        @media (max-width: 480px) { 
            body { line-height: 1.7; } 
            .container { padding: 0 18px; } 
            header { padding: 2rem 0; } 
            header h1 { font-size: 2rem; } 
            .hero { padding: 3rem 1.5rem; } 
            .hero h2 { font-size: 1.9rem; } 
            .hero p { font-size: 1.05rem; } 
            .cta-button, .modal-content-wrapper button[type="submit"] { 
                padding: 0.9rem 1.75rem; 
                font-size: 0.95rem; 
            } 
            .modal-content-wrapper h2 { font-size: 1.8rem; } 
            #map { height: 450px; } 
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Modular</h1>
            <p>Elegant Modular Living for Ireland</p>
        </div>
    </header>
    <main>
        <div class="container">
            <section class="hero" aria-labelledby="hero-title">
                <h2 id="hero-title">Craft Your Legacy with Bespoke Modular Homes</h2>
                <p>Modular connects landowners and buyers to create sustainable, luxurious living spaces that blend seamlessly with Ireland’s landscapes.</p>
            </section>
            <section class="gallery" aria-labelledby="gallery-title">
                <h2 id="gallery-title">Envision Your Future Home</h2>
                <div class="gallery-grid">
                    <div class="gallery-item" tabindex="0">
                        <img src="https://lirp.cdn-website.com/699d2b8a/dms3rep/multi/opt/DALL-E+2025-03-10+15.37.33+-+A+serene+residential+setting+featuring+a+modern+modular+home+in+Alabama.+The+home+has+a+sleek+design+with+clean+lines-+large+windows-+and+a+well-maint-1920x1080-8c5466e5-640w.jpg" alt="Modern Modular Home with sleek design and large windows." loading="lazy">
                        <div class="gallery-caption">Sleek modernity: Clean lines and large windows for a serene, eco-conscious home.</div>
                    </div>
                    <div class="gallery-item" tabindex="0">
                        <img src="https://prod.rockmedialibrary.com/api/public/content/20bf155f45fa4aa49bd1be1424f25094?v=4ce3ce1a" alt="Contemporary Modular Home with bespoke design." loading="lazy">
                        <div class="gallery-caption">Contemporary elegance: Bespoke modular design with sustainable craftsmanship.</div>
                    </div>
                    <div class="gallery-item" tabindex="0">
                        <img src="https://www.irishtimes.com/resizer/v2/XWGYNAO2FNJPLOSZA3FD5FZHHI.jpg?auth=db8dae545d8652a9d92cf46fbfa56947bb432c8f6e8ab4d1e9da9da794534edf&smart=true&width=1600&height=900" alt="Luxurious Irish Modular Home in a natural landscape." loading="lazy">
                        <div class="gallery-caption">Irish charm: Luxurious modular living tailored for Ireland’s landscapes.</div>
                    </div>
                </div>
            </section>
            <div class="cta-sections">
                <section class="cta-section" id="landowners-cta" aria-labelledby="landowner-title">
                    <h2 id="landowner-title">Are you Selling Land?</h2>
                    <p>Transform your land into an exclusive modular community, blending sustainability with unparalleled value.</p>
                    <a href="#landowners-cta" class="cta-button" data-modal="landowner">Offer Your Land</a>
                </section>
                <section class="cta-section" id="buyers-cta" aria-labelledby="buyer-title">
                    <h2 id="buyer-title">Are you Looking to Buy?</h2>
                    <p>Discover bespoke modular homes or prime land plots, designed for elegance and eco-conscious living.</p>
                    <a href="#buyers-cta" class="cta-button" data-modal="buyer">Find Your Dream Home</a>
                </section>
            </div>
            <section class="how-it-works" aria-labelledby="how-it-works-title">
                <h2 id="how-it-works-title">Our Process</h2>
                <ol>
                    <li>Share Your Vision: Complete our tailored interest form.</li>
                    <li>Connect Seamlessly: We match you with curated opportunities.</li>
                    <li>Craft Your Future: Build or buy with our expert guidance.</li>
                </ol>
            </section>
            <section id="map-container" aria-labelledby="map-title">
                <h2 id="map-title">Explore Opportunities on the Map</h2>
                <div id="map"></div>
            </section>
        </div>
    </main>
    <div class="modal" id="form-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title-element">
        <div class="modal-content-wrapper">
            <button class="close-modal" aria-label="Close modal" type="button">×</button>
            <div id="modal-dynamic-content"></div>
        </div>
    </div>
    <template id="landowner-form-template">
        <h2 id="modal-title-element">Landowner Interest Form</h2>
        <form>
            <input type="hidden" name="formType" value="landowner">
            <label for="landowner-name">Full Name</label>
            <input type="text" id="landowner-name" name="name" required placeholder="John Doe">
            <label for="landowner-email">Email Address</label>
            <input type="email" id="landowner-email" name="email" required placeholder="john@example.com">
            <label for="landowner-land-size">Land Size (acres)</label>
            <input type="number" id="landowner-land-size" name="land_size" min="0" step="0.1" placeholder="5.0">
            <label for="landowner-location">Location (County)</label>
            <input type="text" id="landowner-location" name="location" placeholder="Co. Meath">
            <label for="landowner-location-detail">Specific Location Description</label>
            <input type="text" id="landowner-location-detail" name="location_detail" placeholder="E.g., Near town center, specific address if comfortable">
            <label for="form-map-interactive-landowner" style="margin-top: 0.6rem; display: block;">Pinpoint Location on Map (Optional):</label>
            <div id="form-map-interactive-landowner" class="form-map-container"></div>
            <small class="form-map-instruction">Click map to set/adjust pin. Your browser location may be used as a starting point if available.</small>
            <input type="hidden" name="latitude" id="landowner-latitude">
            <input type="hidden" name="longitude" id="landowner-longitude">
            <label for="landowner-goals">Development Goals</label>
            <textarea id="landowner-goals" name="goals" placeholder="E.g., Create a sustainable modular community"></textarea>
            <button type="submit">Submit Interest</button>
        </form>
    </template>
    <template id="buyer-form-template">
        <h2 id="modal-title-element">Buyer Interest Form</h2>
        <form>
            <input type="hidden" name="formType" value="buyer">
            <label for="buyer-name">Full Name</label>
            <input type="text" id="buyer-name" name="name" required placeholder="Jane Smith">
            <label for="buyer-email">Email Address</label>
            <input type="email" id="buyer-email" name="email" required placeholder="jane@example.com">
            <label for="buyer-budget">Budget (€)</label>
            <input type="number" id="buyer-budget" name="budget" min="0" placeholder="400000">
            <label for="buyer-type">Interest Type</label>
            <select id="buyer-type" name="type" required>
                <option value="">Select...</option>
                <option value="land">Land Plot Only</option>
                <option value="home">Modular Home + Land</option>
            </select>
            <label for="buyer-location">Target Location/County</label>
            <input type="text" id="buyer-location" name="location" placeholder="Co. Cork">
            <label for="buyer-location-detail">Specific Preferred Location Description</label>
            <input type="text" id="buyer-location-detail" name="location_detail" placeholder="E.g., Rural setting, close to amenities">
            <label for="form-map-interactive-buyer" style="margin-top: 0.6rem; display: block;">Pinpoint Preferred Area on Map (Optional):</label>
            <div id="form-map-interactive-buyer" class="form-map-container"></div>
            <small class="form-map-instruction">Click map to set/adjust pin. Your browser location may be used as a starting point if available.</small>
            <input type="hidden" name="latitude" id="buyer-latitude">
            <input type="hidden" name="longitude" id="buyer-longitude">
            <label for="buyer-preferences">Preferences</label>
            <textarea id="buyer-preferences" name="preferences" placeholder="E.g., Eco-friendly design, 3 bedrooms, solar panels"></textarea>
            <button type="submit">Submit Interest</button>
        </form>
    </template>
    <footer>
        <div class="container">
            <p>© <span id="current-year">2025</span> Modular. All Rights Reserved.</p>
            <div class="social-icons">
                <a href="#" aria-label="Facebook" role="img">📘</a>
                <a href="#" aria-label="Twitter" role="img">🐦</a>
                <a href="#" aria-label="LinkedIn" role="img">💼</a>
            </div>
        </div>
    </footer>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>
    <script>
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwL0NKGu3AnUtkf4Z-GIMkeNnR1vulFq443ZRm5Fi6ZiRRDt45hgOzRXtVAenr51ph6/exec';
        const irelandCenter = [53.4129, -8.2439];
        let map;
        let activeMarkers = [];
        let formMapInstance = null;
        let formMapMarker = null;

        // Custom SVG Icons
        const landownerIconSvg = `
            <svg width="36" height="48" viewBox="0 0 36 48" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 0C8.059 0 0 8.059 0 18c0 13.5 18 30 18 30s18-16.5 18-30C36 8.059 27.941 0 18 0z" fill="#1A3C34"/>
                <circle cx="18" cy="18" r="10" fill="#EAD9A3" opacity="0.9"/>
                <circle cx="18" cy="18" r="6" fill="#FFFFFF" opacity="0.8"/>
            </svg>`;
        const buyerIconSvg = `
            <svg width="36" height="48" viewBox="0 0 36 48" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 0C8.059 0 0 8.059 0 18c0 13.5 18 30 18 30s18-16.5 18-30C36 8.059 27.941 0 18 0z" fill="#3A6791"/>
                <circle cx="18" cy="18" r="10" fill="#EAD9A3" opacity="0.9"/>
                <circle cx="18" cy="18" r="6" fill="#FFFFFF" opacity="0.8"/>
            </svg>`;
        
        const landownerIcon = L.divIcon({
            html: landownerIconSvg,
            className: 'custom-marker',
            iconSize: [36, 48],
            iconAnchor: [18, 48],
            popupAnchor: [0, -44]
        });
        const buyerIcon = L.divIcon({
            html: buyerIconSvg,
            className: 'custom-marker',
            iconSize: [36, 48],
            iconAnchor: [18, 48],
            popupAnchor: [0, -44]
        });

        async function initializeLeafletMap() {
            if (!document.getElementById('map')) {
                console.error("Main map container 'map' not found.");
                return;
            }
            if (!map) {
                map = L.map('map', { scrollWheelZoom: false }).setView(irelandCenter, 7);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                    maxZoom: 18,
                }).addTo(map);
            }
            activeMarkers.forEach(marker => map.removeLayer(marker));
            activeMarkers = [];
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL);
                const result = await response.json();
                if (result.status === "success" && result.data) {
                    plotLeafletMarkers(result.data);
                } else {
                    console.error("Error fetching main map data:", result.message || "Unknown error");
                    document.getElementById('map').innerHTML = '<p style="text-align:center; padding-top:50px;">Could not load map data.</p>';
                }
            } catch (error) {
                console.error('Error fetching main map data:', error);
                document.getElementById('map').innerHTML = '<p style="text-align:center; padding-top:50px;">Error loading map data.</p>';
            }
        }

        function plotLeafletMarkers(locations) {
            if (!map) {
                console.error("Main Leaflet map not initialized.");
                return;
            }
            if (!locations || locations.length === 0) {
                console.log("No locations to plot on main map.");
                return;
            }
            locations.forEach(location => {
                if (typeof location.latitude !== 'number' || typeof location.longitude !== 'number' || isNaN(location.latitude) || isNaN(location.longitude)) {
                    console.warn("Skipping invalid location data:", location);
                    return;
                }
                const marker = L.marker([location.latitude, location.longitude], {
                    title: `${location.type}: ${location.name}`,
                    icon: location.type === "Landowner" ? landownerIcon : buyerIcon
                }).addTo(map);
                const popupContent = `<strong>${location.type}: ${location.name}</strong><br>${location.details || ''}<p><small>Lat: ${location.latitude.toFixed(4)}, Lng: ${location.longitude.toFixed(4)}</small></p>`;
                marker.bindPopup(popupContent, {
                    className: 'custom-popup',
                    offset: [0, -44]
                });
                activeMarkers.push(marker);
            });
            if (activeMarkers.length > 0) {
                const group = new L.featureGroup(activeMarkers);
                if (group.getBounds().isValid()) {
                    map.fitBounds(group.getBounds().pad(0.15));
                } else if (activeMarkers.length === 1) {
                    map.setView(activeMarkers[0].getLatLng(), 10);
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('current-year').textContent = new Date().getFullYear();
            if (typeof L !== 'undefined') {
                initializeLeafletMap();
            } else {
                console.error("Leaflet library not loaded.");
                const mapDiv = document.getElementById('map');
                if (mapDiv) mapDiv.innerHTML = '<p style="text-align:center; padding-top:50px;">Map library could not be loaded.</p>';
            }

            const modal = document.getElementById('form-modal');
            const modalDynamicContent = document.getElementById('modal-dynamic-content');
            const ctaButtons = document.querySelectorAll('.cta-button[data-modal]');
            const closeModalButton = modal.querySelector('.close-modal');
            let previouslyFocusedElement = null;

            function updateFormLocationFields(form, lat, lng) {
                const latInput = form.querySelector('input[name="latitude"]');
                const lonInput = form.querySelector('input[name="longitude"]');
                if (latInput) latInput.value = lat;
                if (lonInput) lonInput.value = lng;
            }

            function initializeFormMapAndGeolocation(formElement) {
                const formTypeInput = formElement.querySelector('input[name="formType"]');
                if (!formTypeInput) {
                    console.error("Form type input not found.");
                    updateFormLocationFields(formElement, '', '');
                    return;
                }
                const mapDivId = formTypeInput.value === 'landowner' ? 'form-map-interactive-landowner' : 'form-map-interactive-buyer';
                const formMapDiv = formElement.querySelector(`#${mapDivId}`);
                if (!formMapDiv) {
                    console.error("Form map div not found:", mapDivId);
                    updateFormLocationFields(formElement, '', '');
                    return;
                }
                if (formMapInstance) {
                    try {
                        formMapInstance.remove();
                    } catch (e) {
                        console.warn("Error removing old formMapInstance", e);
                    }
                    formMapInstance = null;
                    formMapMarker = null;
                }
                formMapInstance = L.map(formMapDiv, { scrollWheelZoom: false }).setView(irelandCenter, 6);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OSM',
                    maxZoom: 18,
                }).addTo(formMapInstance);

                function placeMarkerAndUpdate(latlng, zoomLevel = 13, setMapView = true) {
                    if (formMapMarker) {
                        try {
                            formMapInstance.removeLayer(formMapMarker);
                        } catch (e) {}
                    }
                    formMapMarker = L.marker(latlng, {
                        draggable: true,
                        icon: formTypeInput.value === 'landowner' ? landownerIcon : buyerIcon
                    }).addTo(formMapInstance);
                    if (setMapView) {
                        formMapInstance.setView(latlng, zoomLevel);
                    }
                    updateFormLocationFields(formElement, latlng.lat.toFixed(6), latlng.lng.toFixed(6));
                    formMapMarker.on('dragend', function (event) {
                        const newLatLng = event.target.getLatLng();
                        updateFormLocationFields(formElement, newLatLng.lat.toFixed(6), newLatLng.lng.toFixed(6));
                    });
                }

                updateFormLocationFields(formElement, '', '');
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            placeMarkerAndUpdate(L.latLng(position.coords.latitude, position.coords.longitude));
                        },
                        (error) => {
                            console.warn(`Geolocation error: ${error.message}`);
                        },
                        { enableHighAccuracy: false, timeout: 8000, maximumAge: 60000 }
                    );
                } else {
                    console.warn('Geolocation not supported.');
                }
                formMapInstance.on('click', function (e) {
                    placeMarkerAndUpdate(e.latlng, formMapInstance.getZoom(), false);
                });
                setTimeout(() => {
                    if (formMapInstance) formMapInstance.invalidateSize();
                }, 400);
            }

            function openModal(type) {
                previouslyFocusedElement = document.activeElement;
                const templateId = `${type}-form-template`;
                const template = document.getElementById(templateId);
                if (!template) {
                    console.error(`Template not found: ${templateId}`);
                    return;
                }
                modalDynamicContent.innerHTML = template.innerHTML;
                const currentForm = modalDynamicContent.querySelector('form');
                modal.classList.add('is-open');
                document.body.style.overflow = 'hidden';
                if (currentForm) {
                    initializeFormMapAndGeolocation(currentForm);
                }
                const firstFocusableElement = modal.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
                if (firstFocusableElement) firstFocusableElement.focus();
                const modalTitle = modalDynamicContent.querySelector('h2');
                if (modalTitle && modalTitle.id) modal.setAttribute('aria-labelledby', modalTitle.id);
            }

            function closeModal() {
                modal.classList.remove('is-open');
                document.body.style.overflow = '';
                if (formMapInstance) {
                    try {
                        formMapInstance.remove();
                    } catch (e) {
                        console.warn("Error removing formMapInstance", e);
                    }
                    formMapInstance = null;
                    formMapMarker = null;
                }
                modalDynamicContent.innerHTML = '';
                if (previouslyFocusedElement) previouslyFocusedElement.focus();
            }

            ctaButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    const type = button.getAttribute('data-modal');
                    openModal(type);
                });
            });

            closeModalButton.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal();
            });
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && modal.classList.contains('is-open')) closeModal();
            });

            modal.addEventListener('keydown', (e) => {
                if (e.key !== 'Tab' || !modal.classList.contains('is-open')) return;
                const focusableElements = Array.from(modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter(el => el.offsetParent !== null && !el.disabled);
                if (focusableElements.length === 0) return;
                const firstElement = focusableElements[0];
                const lastElement = focusableElements[focusableElements.length - 1];
                if (e.shiftKey) {
                    if (document.activeElement === firstElement) {
                        lastElement.focus();
                        e.preventDefault();
                    }
                } else {
                    if (document.activeElement === lastElement) {
                        firstElement.focus();
                        e.preventDefault();
                    }
                }
            });

            modalDynamicContent.addEventListener('submit', async (e) => {
                e.preventDefault();
                const form = e.target;
                const submitButton = form.querySelector('button[type="submit"]');
                const originalButtonText = submitButton.textContent;
                submitButton.disabled = true;
                submitButton.textContent = 'Submitting...';
                if (!GOOGLE_SCRIPT_URL || GOOGLE_SCRIPT_URL.includes('YOUR_')) {
                    console.error("Google Script URL not set.");
                    alert("Configuration error: Submission URL not set.");
                    submitButton.disabled = false;
                    submitButton.textContent = originalButtonText;
                    return;
                }
                try {
                    const response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        body: new FormData(form)
                    });
                    const result = await response.json();
                    if (result.status === "success") {
                        alert('Success! Your information has been submitted.');
                        form.reset();
                        closeModal();
                        if (typeof L !== 'undefined' && map) {
                            initializeLeafletMap();
                        }
                    } else {
                        console.error('Submission error:', result.message || 'Unknown error.');
                        alert('Error: ' + (result.message || 'Could not submit form.'));
                    }
                } catch (error) {
                    console.error('Network error:', error);
                    alert('An error occurred: ' + error.message);
                } finally {
                    submitButton.disabled = false;
                    submitButton.textContent = originalButtonText;
                }
            });
        });
    </script>
</body>
</html>
